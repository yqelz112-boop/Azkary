<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø£Ø°ÙƒØ§Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠØ© - Smart Azkar</title>
    <meta name="description" content="ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« ÙˆØ§Ù„ØªØ³Ø¨ÙŠØ­">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
/* Inlined styles.css */
:root {
    /* slightly reduced/muted green tones per request */
    --primary: #2e7d32; /* less saturated than before */
    --primary-light: #10b981;
    --primary-dark: #047857;
    --accent: #d4a012;
    --accent-light: #fbbf24;
    --background: #f0fdf4;
    --background-dark: #064e3b;
    --foreground: #1a1a1a;
    --foreground-light: #4a5568;
    --card-bg: #ffffff;
    --card-border: rgba(5, 150, 105, 0.1);
    --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 10px 40px rgba(0, 0, 0, 0.12);
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --font-arabic: 'Amiri', serif;
    --font-main: 'Tajawal', sans-serif;
}

/* Reset & Base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    scroll-behavior: smooth;
}

body {
    font-family: var(--font-main);
    background: var(--background);
    color: var(--foreground);
    line-height: 1.6;
    overflow-x: hidden;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

/* ========================================
   Header & Navigation
   ======================================== */
.header {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    z-index: 1000;
    box-shadow: var(--shadow);
}

.nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px 40px;
    max-width: 1400px;
    margin: 0 auto;
}

.logo {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary);
}

.logo-icon {
    font-size: 2rem;
    color: var(--accent);
}

.nav-links {
    display: flex;
    list-style: none;
    gap: 30px;
}

.nav-links a {
    text-decoration: none;
    color: var(--foreground);
    font-weight: 500;
    transition: var(--transition);
    position: relative;
}

.nav-links a::after {
    content: '';
    position: absolute;
    bottom: -5px;
    right: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: var(--transition);
}

.nav-links a:hover::after {
    width: 100%;
}

.mobile-menu-btn {
    display: none;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: var(--primary);
}

.mobile-menu {
    display: none;
    flex-direction: column;
    background: white;
    padding: 20px;
    gap: 15px;
}

.mobile-menu a {
    text-decoration: none;
    color: var(--foreground);
    padding: 10px;
    border-radius: 8px;
    transition: var(--transition);
}

.mobile-menu a:hover {
    background: var(--background);
}

/* ========================================
   Hero Section
   ======================================== */
.hero {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--background) 0%, #d1fae5 50%, #a7f3d0 100%);
    position: relative;
    padding: 100px 20px 60px;
    overflow: hidden;
}

.hero-decorations {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.decoration {
    position: absolute;
    opacity: 0.3;
    animation: float 6s ease-in-out infinite;
}

.decoration.star {
    top: 20%;
    right: 15%;
    font-size: 2rem;
    color: var(--accent);
    animation-delay: 0s;
}

.decoration.moon {
    top: 30%;
    left: 10%;
    font-size: 3rem;
    color: var(--primary);
    animation-delay: 2s;
}

.decoration.sparkle {
    bottom: 30%;
    right: 20%;
    font-size: 1.5rem;
    color: var(--accent);
    animation-delay: 4s;
}

@keyframes float {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-20px) rotate(10deg); }
}

.hero-content {
    text-align: center;
    max-width: 800px;
    z-index: 1;
}

.hero-title {
    font-family: var(--font-arabic);
    font-size: 4rem;
    color: var(--primary);
    margin-bottom: 20px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
}

.hero-subtitle {
    font-size: 1.5rem;
    color: var(--accent);
    margin-bottom: 20px;
}

.hero-description {
    font-size: 1.1rem;
    color: var(--foreground-light);
    margin-bottom: 40px;
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
}

.hero-buttons {
    display: flex;
    gap: 20px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 60px;
}

/* Prayer widget in hero */
.hero-prayer-widget {
    margin: 20px auto 28px;
    background: rgba(255,255,255,0.9);
    border: 1px solid var(--card-border);
    border-radius: 12px;
    padding: 12px 16px;
    max-width: 520px;
    box-shadow: 0 8px 30px rgba(0,0,0,0.06);
}
.hero-prayer-widget .prayer-header {
    display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;font-weight:700;color:var(--primary);
}
.prayer-row{display:flex;justify-content:space-between;padding:8px 6px;border-top:1px dashed rgba(0,0,0,0.04)}
.prayer-row:first-of-type{border-top:none}
.prayer-name{font-weight:600;color:var(--foreground)}
.prayer-time{font-weight:700;color:var(--primary)}

/* toast small tweaks */
.app-toast{opacity:1}

.hero-stats {
    display: flex;
    justify-content: center;
    gap: 60px;
    flex-wrap: wrap;
}

.stat {
    text-align: center;
}

.stat-number {
    display: block;
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--primary);
}

.stat-label {
    color: var(--foreground-light);
    font-size: 0.9rem;
}

/* ========================================
   Buttons
   ======================================== */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 14px 32px;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    transition: var(--transition);
    border: 2px solid transparent;
    font-family: var(--font-main);
}

.btn-primary {
    background: var(--primary);
    color: white;
    box-shadow: 0 4px 15px rgba(5, 150, 105, 0.3);
}

.btn-primary:hover {
    background: var(--primary-light);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
}

.btn-outline {
    background: transparent;
    color: var(--primary);
    border-color: var(--primary);
}

.btn-outline:hover {
    background: var(--primary);
    color: white;
}

.btn-secondary {
    background: var(--card-bg);
    color: var(--foreground);
    border-color: var(--card-border);
}

.btn-secondary:hover {
    background: var(--background);
}

.btn-icon {
    background: transparent;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    padding: 10px;
    border-radius: 50%;
    transition: var(--transition);
}

.btn-icon:hover {
    background: var(--background);
    transform: scale(1.1);
}

/* ========================================
   Section Styles
   ======================================== */
.section-header {
    text-align: center;
    margin-bottom: 50px;
}

.section-title {
    font-family: var(--font-arabic);
    font-size: 2.5rem;
    color: var(--primary);
    margin-bottom: 15px;
}

.section-subtitle {
    color: var(--foreground-light);
    font-size: 1.1rem;
}

/* ... rest of original styles preserved ... */

/* Qibla compass smoothing */
#qiblaArrow {
    transition: transform 350ms cubic-bezier(0.22, 0.9, 0.35, 1);
    will-change: transform;
}
#qiblaCompass {
    transform-origin: 50% 50%;
}
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <nav class="nav">
            <div class="logo">
                <span class="logo-icon">â˜ª</span>
                <span class="logo-text">Ø£Ø°ÙƒØ§Ø±ÙŠ</span>
            </div>
            <ul class="nav-links">
                <li><a href="#home">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="#azkar">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</a></li>
                <li><a href="quran/index.html">Ø§Ù„Ù‚Ø±Ø¢Ù†</a></li>
                <li><a href="prayer.html">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</a></li>
                <li><a href="#hadith">Ø§Ù„Ø­Ø¯ÙŠØ«</a></li>
                <li><a href="#tasbeeh">Ø§Ù„ØªØ³Ø¨ÙŠØ­</a></li>
            </ul>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">â˜°</button>
        </nav>
        <div class="mobile-menu" id="mobileMenu">
            <a href="#home" onclick="closeMobileMenu()">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
            <a href="#azkar" onclick="closeMobileMenu()">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</a>
            <a href="quran/index.html" onclick="closeMobileMenu()">Ø§Ù„Ù‚Ø±Ø¢Ù†</a>
            <a href="prayer.html" onclick="closeMobileMenu()">Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</a>
            <a href="#hadith" onclick="closeMobileMenu()">Ø§Ù„Ø­Ø¯ÙŠØ«</a>
            <a href="#tasbeeh" onclick="closeMobileMenu()">Ø§Ù„ØªØ³Ø¨ÙŠØ­</a>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="hero-decorations">
            <span class="decoration star">âœ¦</span>
            <span class="decoration moon">â˜¾</span>
            <span class="decoration sparkle">âœ§</span>
        </div>
        <div class="hero-content">
            <h1 class="hero-title">Ø£Ø°ÙƒØ§Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠØ©</h1>
            <p class="hero-subtitle">Ø±ÙÙŠÙ‚Ùƒ Ø§Ù„Ø±ÙˆØ­ÙŠ ÙÙŠ ÙƒÙ„ ÙˆÙ‚Øª</p>
            <p class="hero-description">
                Ø§Ø¬Ø¹Ù„ Ø°ÙƒØ± Ø§Ù„Ù„Ù‡ Ø¬Ø²Ø¡Ø§Ù‹ Ù…Ù† ÙŠÙˆÙ…Ùƒ Ù…Ø¹ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø£Ø¯Ø¹ÙŠØ© ÙˆØ§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…
            </p>
            <!-- Prayer times widget -->
            <div id="prayer"></div>
            <div class="hero-prayer-widget" id="prayerWidget">
                <div class="prayer-header">
                    <strong>Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©</strong>
                    <button class="btn btn-outline" id="prayerSettingsBtn">ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹</button>
                </div>
                <div class="prayer-list" id="prayerList">
                    <p class="muted">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª...</p>
                </div>
                <div style="margin-top:8px;display:flex;gap:8px;align-items:center;">
                    <div class="muted" id="prayerLocationDisplay">Ø§Ù„Ù…ÙˆÙ‚Ø¹: <span id="prayerLocationName">ØºÙŠØ± Ù…Ø­Ø¯Ø¯</span></div>
                    <button class="btn btn-small" id="editPrayerLocationBtn" style="padding:6px 8px;">ØªØºÙŠÙŠØ±</button>
                </div>
            </div>
            <!-- Qibla Finder (moved to main interface) -->
            <div id="qiblaFinder" style="margin:18px auto 0;max-width:520px;display:flex;gap:14px;align-items:center;flex-direction:column;">
                <div style="display:flex;gap:12px;width:100%;justify-content:space-between;align-items:center;">
                    <strong>Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù‚Ø¨Ù„Ø©</strong>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <button class="btn btn-outline" id="qiblaUseGeoBtn">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ</button>
                        <button class="btn btn-secondary" id="qiblaUseDeviceBtn">Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØµÙ„Ø©</button>
                    </div>
                </div>
                <div id="qiblaCompass" style="width:160px;height:160px;border-radius:50%;border:6px solid rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;position:relative;background:radial-gradient(circle at 40% 30%, #fff 0%, #f7fafc 40%);">
                    <div id="qiblaArrow" style="width:6px;height:70px;background:var(--primary);position:absolute;top:18px;border-radius:6px;transform-origin:50% 80%;transform:rotate(0deg);"></div>
                    <div style="position:absolute;bottom:8px;font-weight:700;">Ø§Ù„Ù‚Ø¨Ù„Ø©</div>
                </div>
                <div id="qiblaDegree" style="font-weight:700;color:var(--foreground);">Ø§Ù„Ø²Ø§ÙˆÙŠØ©: â€”Â°</div>
                <div id="qiblaHelp" style="color:var(--foreground-light);font-size:0.95rem;">Ø§Ù†Ù‚Ø± "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ" Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø¨Ø¯Ù‚Ø©ØŒ Ø£Ùˆ "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙˆØµÙ„Ø©" Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ù†Ø³Ø¨Ø©Ù‹ Ù„Ø¨ÙˆØµÙ„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø².</div>
            </div>
            <div class="hero-buttons">
                <a href="#azkar" class="btn btn-primary">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</a>
                <a href="#quran" class="btn btn-outline">ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø²ÙŠØ¯</a>
            </div>
            <div class="hero-stats">
                <div class="stat">
                    <span class="stat-number">100+</span>
                    <span class="stat-label">Ø°ÙƒØ± ÙˆÙˆØ±Ø¯</span>
                </div>
                <div class="stat">
                    <span class="stat-number">40+</span>
                    <span class="stat-label">Ø­Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠ</span>
                </div>
                <div class="stat">
                    <span class="stat-number">114</span>
                    <span class="stat-label">Ø³ÙˆØ±Ø© Ù‚Ø±Ø¢Ù†ÙŠØ©</span>
                </div>
            </div>
        </div>
    </section>

        <!-- Location modal for prayer settings (same as prayer.html) -->
        <div id="locationModal" class="modal">
            <div class="modal-content" style="max-width:420px;direction:rtl;text-align:right;">
                <div class="modal-header">
                    <h3>ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</h3>
                    <button class="modal-close" id="closeLocationModal">Ã—</button>
                </div>
                <div class="modal-body">
                    <label>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© (Ù…Ø«Ø§Ù„: Cairo):<br><input type="text" id="locCity" style="width:100%;padding:8px;margin-top:6px;" placeholder="Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"></label>
                    <label style="margin-top:10px;display:block;">Ø§Ù„Ø¯ÙˆÙ„Ø© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ - Ù…Ø«Ø§Ù„: Egypt):<br><input type="text" id="locCountry" style="width:100%;padding:8px;margin-top:6px;" placeholder="Ø§Ù„Ø¯ÙˆÙ„Ø©"></label>
                    <p class="muted" style="margin-top:8px;">ÙŠÙ…ÙƒÙ†Ùƒ ØªØ±Ùƒ Ø§Ù„Ø¯ÙˆÙ„Ø© ÙØ§Ø±ØºØ© Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª. Ø§Ù†Ù‚Ø± Ø­ÙØ¸ Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ù…ÙˆØ§Ù‚ÙŠØª.</p>
                </div>
                <div class="modal-footer" style="text-align:left;margin-top:12px;">
                    <button class="btn btn-secondary" id="saveLocationBtn">Ø­ÙØ¸</button>
                    <button class="btn btn-outline" id="cancelLocationBtn">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>
        </div>
        <!-- Geolocation permission help modal -->
        <div id="locationPermissionModal" class="modal">
            <div class="modal-content" style="max-width:520px;direction:rtl;text-align:right;padding:20px;">
                <div class="modal-header">
                    <h3>Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3>
                    <button class="modal-close" id="closePermissionModal">Ã—</button>
                </div>
                <div class="modal-body">
                    <p>ØªØ¹Ø°Ø± Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙÙŠ Ù…ØªØµÙØ­Ùƒ Ø£Ùˆ Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ´ØºÙŠÙ„ Ø«Ù… Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.</p>
                    <ol>
                        <li>ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø¯ÙŠÙ‡ Ø¥Ø°Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹.</li>
                        <li>Ø¹Ù„Ù‰ Ø§Ù„Ù‡Ø§ØªÙ: Ø§ÙØªØ­ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­ ÙˆØ§Ø®ØªØ± Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ù…ÙˆÙ‚Ø¹.</li>
                        <li>Ø£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø«Ù… Ø§Ø¶ØºØ· "Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©".</li>
                    </ol>
                    <p class="muted">Ø¥Ø°Ø§ Ù„Ù… ØªÙ†Ø¬Ø­ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¯Ø®Ø§Ù„ Ù…Ø¯ÙŠÙ†ØªÙƒ ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙˆØ§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ" Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¨Ø¹Ø¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª.</p>
                </div>
                <div class="modal-footer" style="text-align:left;">
                    <button class="btn btn-primary" id="retryGeolocationBtn">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
                    <button class="btn btn-outline" id="dismissPermissionModal">Ø¥ØºÙ„Ø§Ù‚</button>
                </div>
            </div>
        </div>

    <!-- Azkar Section -->
    <section class="azkar-section" id="azkar">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Ø§Ù„Ø£Ø°ÙƒØ§Ø± ÙˆØ§Ù„Ø£Ø¯Ø¹ÙŠØ©</h2>
                <p class="section-subtitle">Ø§Ø®ØªØ± Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø© Ù…ØªÙ†ÙˆØ¹Ø© Ù…Ù† Ø§Ù„Ø£Ø°ÙƒØ§Ø± Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</p>
            </div>
            <div class="azkar-grid">
                <div class="azkar-card" onclick="openAzkarModal('morning')">
                    <div class="azkar-icon">ğŸŒ…</div>
                    <h3>Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­</h3>
                    <p>Ø§Ø¨Ø¯Ø£ ÙŠÙˆÙ…Ùƒ Ø¨Ø°ÙƒØ± Ø§Ù„Ù„Ù‡</p>
                    <span class="azkar-count">33 Ø°ÙƒØ±</span>
                </div>
                <div class="azkar-card" onclick="openAzkarModal('evening')">
                    <div class="azkar-icon">ğŸŒ™</div>
                    <h3>Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡</h3>
                    <p>Ø§Ø®ØªÙ… ÙŠÙˆÙ…Ùƒ Ø¨Ø§Ù„Ø·Ù…Ø£Ù†ÙŠÙ†Ø©</p>
                    <span class="azkar-count">33 Ø°ÙƒØ±</span>
                </div>
                <div class="azkar-card" onclick="openAzkarModal('sleep')">
                    <div class="azkar-icon">ğŸ˜´</div>
                    <h3>Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…</h3>
                    <p>Ù†Ù… Ø¹Ù„Ù‰ Ø°ÙƒØ± Ø§Ù„Ù„Ù‡</p>
                    <span class="azkar-count">15 Ø°ÙƒØ±</span>
                </div>
                <div class="azkar-card" onclick="openAzkarModal('prayer')">
                    <div class="azkar-icon">ğŸ•Œ</div>
                    <h3>Ø£Ø°ÙƒØ§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø©</h3>
                    <p>Ø£ÙƒÙ…Ù„ ØµÙ„Ø§ØªÙƒ Ø¨Ø§Ù„Ø°ÙƒØ±</p>
                    <span class="azkar-count">20 Ø°ÙƒØ±</span>
                </div>
                <div class="azkar-card" onclick="openAzkarModal('travel')">
                    <div class="azkar-icon">âœˆï¸</div>
                    <h3>Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ø³ÙØ±</h3>
                    <p>Ø±Ø§ÙÙ‚ Ø³ÙØ±Ùƒ Ø¨Ø§Ù„Ø¯Ø¹Ø§Ø¡</p>
                    <span class="azkar-count">12 Ø°ÙƒØ±</span>
                </div>
                <div class="azkar-card" onclick="openAzkarModal('general')">
                    <div class="azkar-icon">ğŸ“¿</div>
                    <h3>Ø£Ø°ÙƒØ§Ø± Ù…ØªÙ†ÙˆØ¹Ø©</h3>
                    <p>Ø£Ø°ÙƒØ§Ø± Ù„ÙƒÙ„ Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª</p>
                    <span class="azkar-count">25 Ø°ÙƒØ±</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Quran Section -->
    <section class="quran-section" id="quran">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…</h2>
                <p class="section-subtitle">Ø§Ù‚Ø±Ø£ ÙˆØ§Ø³ØªÙ…Ø¹ Ø¥Ù„Ù‰ Ø¢ÙŠØ§Øª Ù…Ù† ÙƒØªØ§Ø¨ Ø§Ù„Ù„Ù‡</p>
            </div>
            <div class="quran-featured">
                <div class="quran-verse-card">
                    <div class="verse-header">
                        <span class="surah-name">Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø©</span>
                        <span class="verse-number">Ø§Ù„Ø¢ÙŠØ© 1-7</span>
                    </div>
                    <p class="verse-text">
                        Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù Û Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù Ø±ÙØ¨ÙÙ‘ Ø§Ù„Ù’Ø¹ÙØ§Ù„ÙÙ…ÙÙŠÙ†Ù Û Ø§Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ø§Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù Û Ù…ÙØ§Ù„ÙÙƒÙ ÙŠÙÙˆÙ’Ù…Ù Ø§Ù„Ø¯ÙÙ‘ÙŠÙ†Ù
                    </p>
                    <div class="verse-actions">
                        <button class="btn-icon" title="Ø§Ø³ØªÙ…Ø¹">ğŸ”Š</button>
                        <button class="btn-icon" title="Ø§Ø­ÙØ¸">ğŸ”–</button>
                        <button class="btn-icon" title="Ø´Ø§Ø±Ùƒ">ğŸ“¤</button>
                    </div>
                </div>
            </div>
            <div class="surah-grid">
                <div class="surah-card">
                    <span class="surah-number">1</span>
                    <div class="surah-info">
                        <h4>Ø§Ù„ÙØ§ØªØ­Ø©</h4>
                        <span>7 Ø¢ÙŠØ§Øª â€¢ Ù…ÙƒÙŠØ©</span>
                    </div>
                </div>
                <div class="surah-card">
                    <span class="surah-number">36</span>
                    <div class="surah-info">
                        <h4>ÙŠØ³</h4>
                        <span>83 Ø¢ÙŠØ© â€¢ Ù…ÙƒÙŠØ©</span>
                    </div>
                </div>
                <div class="surah-card">
                    <span class="surah-number">67</span>
                    <div class="surah-info">
                        <h4>Ø§Ù„Ù…Ù„Ùƒ</h4>
                        <span>30 Ø¢ÙŠØ© â€¢ Ù…ÙƒÙŠØ©</span>
                    </div>
                </div>
                <div class="surah-card">
                    <span class="surah-number">55</span>
                    <div class="surah-info">
                        <h4>Ø§Ù„Ø±Ø­Ù…Ù†</h4>
                        <span>78 Ø¢ÙŠØ© â€¢ Ù…Ø¯Ù†ÙŠØ©</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Hadith Section -->
    <section class="hadith-section" id="hadith">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Ø­Ø¯ÙŠØ« Ø§Ù„ÙŠÙˆÙ…</h2>
                <p class="section-subtitle">ØªØ¹Ù„Ù… Ù…Ù† Ø³Ù†Ø© Ø§Ù„Ù†Ø¨ÙŠ ï·º</p>
            </div>
            <div class="hadith-carousel">
                <button class="carousel-btn prev" onclick="prevHadith()">â®</button>
                <div class="hadith-card" id="hadithCard">
                    <div class="hadith-content">
                        <p class="hadith-text" id="hadithText"></p>
                        <div class="hadith-info">
                            <span class="hadith-narrator" id="hadithNarrator"></span>
                            <span class="hadith-source" id="hadithSource"></span>
                        </div>
                    </div>
                    <div class="hadith-actions">
                        <button class="btn-icon" onclick="toggleLikeHadith()" id="likeBtn">ğŸ¤</button>
                        <button class="btn-icon" onclick="shareHadith()">ğŸ“¤</button>
                    </div>
                </div>
                <button class="carousel-btn next" onclick="nextHadith()">â¯</button>
            </div>
            <div class="hadith-dots" id="hadithDots"></div>
        </div>
    </section>

    <!-- Tasbeeh Section -->
    <section class="tasbeeh-section" id="tasbeeh">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Ø§Ù„Ù…Ø³Ø¨Ø­Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</h2>
                <p class="section-subtitle">Ø³Ø¨Ø­ ÙˆØ§Ø°ÙƒØ± Ø§Ù„Ù„Ù‡ Ø¨Ø³Ù‡ÙˆÙ„Ø©</p>
            </div>
            <div class="tasbeeh-container">
                <div class="tasbeeh-options">
                    <button class="tasbeeh-option active" data-target="33" onclick="selectTasbeeh(this, 'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡', 'Glory be to Allah', 33)">
                        <span class="option-text">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</span>
                        <span class="option-count">33</span>
                    </button>
                    <button class="tasbeeh-option" data-target="33" onclick="selectTasbeeh(this, 'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡', 'Praise be to Allah', 33)">
                        <span class="option-text">Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡</span>
                        <span class="option-count">33</span>
                    </button>
                    <button class="tasbeeh-option" data-target="34" onclick="selectTasbeeh(this, 'Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±', 'Allah is the Greatest', 34)">
                        <span class="option-text">Ø§Ù„Ù„Ù‡ Ø£ÙƒØ¨Ø±</span>
                        <span class="option-count">34</span>
                    </button>
                    <button class="tasbeeh-option" data-target="100" onclick="selectTasbeeh(this, 'Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡', 'There is no god but Allah', 100)">
                        <span class="option-text">Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡</span>
                        <span class="option-count">100</span>
                    </button>
                </div>
                <div class="tasbeeh-counter">
                    <div class="counter-circle" onclick="incrementCounter()">
                        <svg class="progress-ring" viewBox="0 0 200 200">
                            <circle class="progress-ring-bg" cx="100" cy="100" r="90"></circle>
                            <circle class="progress-ring-fill" id="progressRing" cx="100" cy="100" r="90"></circle>
                        </svg>
                        <div class="counter-content">
                            <span class="counter-number" id="counterNumber">0</span>
                            <span class="counter-target" id="counterTarget">/ 33</span>
                        </div>
                    </div>
                    <div class="tasbeeh-text">
                        <p class="tasbeeh-arabic" id="tasbeehArabic">Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡</p>
                        <p class="tasbeeh-translation" id="tasbeehTranslation">Glory be to Allah</p>
                    </div>
                    <div class="tasbeeh-controls">
                        <button class="btn btn-secondary" onclick="toggleSound()">
                            <span id="soundIcon">ğŸ”Š</span>
                        </button>
                        <button class="btn btn-secondary" onclick="resetCounter()">Ø¥Ø¹Ø§Ø¯Ø©</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <span class="logo-icon">â˜ª</span>
                    <span class="logo-text">Ø£Ø°ÙƒØ§Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠØ©</span>
                    <p>Ø±ÙÙŠÙ‚Ùƒ Ø§Ù„Ø±ÙˆØ­ÙŠ ÙÙŠ ÙƒÙ„ ÙˆÙ‚Øª</p>
                </div>
                <div class="footer-links">
                    <h4>Ø±ÙˆØ§Ø¨Ø· Ø³Ø±ÙŠØ¹Ø©</h4>
                    <a href="#azkar">Ø§Ù„Ø£Ø°ÙƒØ§Ø±</a>
                        <a href="quran/index.html">Ø§Ù„Ù‚Ø±Ø¢Ù†</a>
                        <a href="#hadith">Ø§Ù„Ø­Ø¯ÙŠØ«</a>
                        <a href="#tasbeeh">Ø§Ù„ØªØ³Ø¨ÙŠØ­</a>
                </div>
                <div class="footer-contact">
                    <h4>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h4>
                    <p>Ù„Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>Â© 2024 Ø£Ø°ÙƒØ§Ø±ÙŠ Ø§Ù„Ø°ÙƒÙŠØ©. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
            </div>
        </div>
    </footer>

    <!-- Azkar Modal -->
    <div class="modal" id="azkarModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­</h3>
                <button class="modal-close" onclick="closeAzkarModal()">Ã—</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Azkar will be loaded here -->
            </div>
        </div>
    </div>

    <script>
// Inlined script.js
function toggleMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    menu.classList.toggle('active');
}

function closeMobileMenu() {
    const menu = document.getElementById('mobileMenu');
    menu.classList.remove('active');
}

// ========================================
// Hadith Data & Carousel
// ========================================
const hadiths = [
    {
        id: 1,
        text: "Ø¥Ù†Ù…Ø§ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ø¨Ø§Ù„Ù†ÙŠØ§ØªØŒ ÙˆØ¥Ù†Ù…Ø§ Ù„ÙƒÙ„ Ø§Ù…Ø±Ø¦ Ù…Ø§ Ù†ÙˆÙ‰",
        narrator: "Ø¹Ù…Ø± Ø¨Ù† Ø§Ù„Ø®Ø·Ø§Ø¨ Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡",
        source: "ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ"
    },
    {
        id: 2,
        text: "Ù…Ù† ÙƒØ§Ù† ÙŠØ¤Ù…Ù† Ø¨Ø§Ù„Ù„Ù‡ ÙˆØ§Ù„ÙŠÙˆÙ… Ø§Ù„Ø¢Ø®Ø± ÙÙ„ÙŠÙ‚Ù„ Ø®ÙŠØ±Ø§Ù‹ Ø£Ùˆ Ù„ÙŠØµÙ…Øª",
        narrator: "Ø£Ø¨Ùˆ Ù‡Ø±ÙŠØ±Ø© Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡",
        source: "ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ"
    },
    {
        id: 3,
        text: "Ù„Ø§ ÙŠØ¤Ù…Ù† Ø£Ø­Ø¯ÙƒÙ… Ø­ØªÙ‰ ÙŠØ­Ø¨ Ù„Ø£Ø®ÙŠÙ‡ Ù…Ø§ ÙŠØ­Ø¨ Ù„Ù†ÙØ³Ù‡",
        narrator: "Ø£Ù†Ø³ Ø¨Ù† Ù…Ø§Ù„Ùƒ Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡",
        source: "ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ"
    },
    {
        id: 4,
        text: "Ø§Ù„Ù…Ø³Ù„Ù… Ù…Ù† Ø³Ù„Ù… Ø§Ù„Ù…Ø³Ù„Ù…ÙˆÙ† Ù…Ù† Ù„Ø³Ø§Ù†Ù‡ ÙˆÙŠØ¯Ù‡",
        narrator: "Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ø¨Ù† Ø¹Ù…Ø±Ùˆ Ø±Ø¶ÙŠ Ø§Ù„Ù„Ù‡ Ø¹Ù†Ù‡",
        source: "ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ"
    }
];

let currentHadithIndex = 0;
let likedHadiths = [];

function initHadithCarousel() {
    updateHadithDisplay();
    createHadithDots();
}

function updateHadithDisplay() {
    const hadith = hadiths[currentHadithIndex];
    const tEl = document.getElementById('hadithText'); if (tEl) tEl.textContent = hadith.text;
    const nEl = document.getElementById('hadithNarrator'); if (nEl) nEl.textContent = hadith.narrator;
    const sEl = document.getElementById('hadithSource'); if (sEl) sEl.textContent = hadith.source;
    const likeBtn = document.getElementById('likeBtn');
    if (likeBtn) likeBtn.textContent = likedHadiths.includes(hadith.id) ? 'â¤ï¸' : 'ğŸ¤';
    updateHadithDots();
}

function createHadithDots() {
    const dotsContainer = document.getElementById('hadithDots');
    if (!dotsContainer) return;
    dotsContainer.innerHTML = '';
    hadiths.forEach((_, index) => {
        const dot = document.createElement('span');
        dot.className = `hadith-dot ${index === currentHadithIndex ? 'active' : ''}`;
        dot.onclick = () => goToHadith(index);
        dotsContainer.appendChild(dot);
    });
}

function updateHadithDots() {
    const dots = document.querySelectorAll('.hadith-dot');
    dots.forEach((dot, index) => {
        dot.classList.toggle('active', index === currentHadithIndex);
    });
}

function prevHadith() {
    currentHadithIndex = (currentHadithIndex - 1 + hadiths.length) % hadiths.length;
    updateHadithDisplay();
}

function nextHadith() {
    currentHadithIndex = (currentHadithIndex + 1) % hadiths.length;
    updateHadithDisplay();
}

function goToHadith(index) {
    currentHadithIndex = index;
    updateHadithDisplay();
}

function toggleLikeHadith() {
    const hadithId = hadiths[currentHadithIndex].id;
    if (likedHadiths.includes(hadithId)) {
        likedHadiths = likedHadiths.filter(id => id !== hadithId);
    } else {
        likedHadiths.push(hadithId);
    }
    updateHadithDisplay();
}

function shareHadith() {
    const hadith = hadiths[currentHadithIndex];
    const text = `${hadith.text}\n\n- ${hadith.narrator}\nğŸ“– ${hadith.source}`;
    
    if (navigator.share) {
        navigator.share({
            title: 'Ø­Ø¯ÙŠØ« Ù†Ø¨ÙˆÙŠ',
            text: text
        });
    } else {
        navigator.clipboard.writeText(text).then(() => {
            alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø­Ø¯ÙŠØ«!');
        });
    }
}

// ========================================
// Tasbeeh Counter
// ========================================
let tasbeehCount = 0;
let tasbeehTarget = 33;
let tasbeehArabic = 'Ø³Ø¨Ø­Ø§Ù† Ø§Ù„Ù„Ù‡';
let tasbeehTranslation = 'Glory be to Allah';
let soundEnabled = true;

function selectTasbeeh(element, arabic, translation, target) {
    // Update active state
    document.querySelectorAll('.tasbeeh-option').forEach(opt => opt.classList.remove('active'));
    if (element) element.classList.add('active');
    
    // Update values
    tasbeehArabic = arabic;
    tasbeehTranslation = translation;
    tasbeehTarget = target;
    tasbeehCount = 0;
    
    // Update display
    const elA = document.getElementById('tasbeehArabic'); if (elA) elA.textContent = arabic;
    const elT = document.getElementById('tasbeehTranslation'); if (elT) elT.textContent = translation;
    const elC = document.getElementById('counterTarget'); if (elC) elC.textContent = `/ ${target}`;
    updateCounterDisplay();
}

function incrementCounter() {
    if (tasbeehCount < tasbeehTarget) {
        tasbeehCount++;
        updateCounterDisplay();
        
        if (soundEnabled) {
            playClickSound();
        }
        
        if (tasbeehCount === tasbeehTarget) {
            celebrateCompletion();
        }
    }
}

function updateCounterDisplay() {
    const el = document.getElementById('counterNumber'); if (el) el.textContent = tasbeehCount;
    const progressRing = document.getElementById('progressRing');
    if (progressRing) {
        const circumference = 2 * Math.PI * 90;
        const progress = tasbeehCount / tasbeehTarget;
        const offset = circumference * (1 - progress);
        progressRing.style.strokeDashoffset = offset;
    }
}

function resetCounter() {
    tasbeehCount = 0;
    updateCounterDisplay();
}

function toggleSound() {
    soundEnabled = !soundEnabled;
    const s = document.getElementById('soundIcon'); if (s) s.textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
}

function playClickSound() {
    try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        oscillator.frequency.value = 800;
        oscillator.type = 'sine';
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
    } catch (e) {
        // Audio not supported
    }
}

function celebrateCompletion() {
    const counterCircle = document.querySelector('.counter-circle');
    if (counterCircle) counterCircle.style.animation = 'pulse 0.5s ease-in-out 3';
    setTimeout(() => {
        if (counterCircle) counterCircle.style.animation = '';
        showToast('Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! Ø£ÙƒÙ…Ù„Øª Ø§Ù„ØªØ³Ø¨ÙŠØ­ ğŸ‰');
        showNotification('Ø§Ù„Ù…Ø³Ø¨Ø­Ø©', 'Ù…Ø§ Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡! Ø£ÙƒÙ…Ù„Øª Ø¹Ø¯Ø¯ Ø§Ù„ØªØ³Ø¨ÙŠØ­ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨');
    }, 1500);
}

// -------------------------------
// Toast & Notification helpers
// -------------------------------
function showToast(message, timeout = 4500) {
    const container = document.getElementById('toastContainer');
    if (!container) return;
    const toast = document.createElement('div');
    toast.className = 'app-toast';
    toast.textContent = message;
    toast.style = 'background:rgba(0,0,0,0.85);color:#fff;padding:12px 16px;border-radius:8px;margin-top:8px;box-shadow:0 6px 18px rgba(0,0,0,0.25);font-weight:600;';
    container.appendChild(toast);
    setTimeout(() => {
        toast.style.transition = 'opacity .35s ease, transform .35s ease';
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(8px)';
        setTimeout(() => container.removeChild(toast), 400);
    }, timeout);
}

function showNotification(title, body) {
    if (window.Notification && Notification.permission === 'granted') {
        new Notification(title, { body });
    } else if (window.Notification && Notification.permission !== 'denied') {
        Notification.requestPermission().then(permission => {
            if (permission === 'granted') new Notification(title, { body });
        });
    } else {
        showToast(`${title} â€” ${body}`);
    }
}

// -------------------------------
// Prayer times widget
// -------------------------------
const PRAYER_API_METHOD = 3; // Muslim World League by default
let scheduledPrayerTimeouts = [];
let currentQiblaBearing = null;
let deviceOrientationHandler = null;

function initPrayerWidget() {
    const btn = document.getElementById('prayerSettingsBtn');
    if (btn) btn.addEventListener('click', promptForLocation);
    const editBtn = document.getElementById('editPrayerLocationBtn');
    if (editBtn) editBtn.addEventListener('click', promptForLocation);
    updatePrayerLocationDisplay();
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            fetchPrayerTimes(pos.coords.latitude, pos.coords.longitude);
            try{ updateQibla(pos.coords.latitude, pos.coords.longitude); }catch(e){}
        }, err => {}, { timeout: 8000 });
    }
    try {
        const onPrayerPage = window.location.pathname.endsWith('prayer.html') || window.location.href.includes('prayer.html');
        const saved = localStorage.getItem('prayer_location');
        if (onPrayerPage && (!saved || saved === 'null')) {
            const inlineForm = document.getElementById('inlineLocationForm');
            if (inlineForm) {
                const cityEl = document.getElementById('inlineLocCity');
                const countryEl = document.getElementById('inlineLocCountry');
                try{ const obj = JSON.parse(saved || 'null'); if (cityEl && obj) cityEl.value = obj.city || ''; if (countryEl && obj) countryEl.value = obj.country || ''; }catch(e){}
                setTimeout(()=> showInlineLocationForm(), 300);
            } else {
                setTimeout(() => { promptForLocation(); }, 350);
            }
        }
    } catch (e) {}
}

// Qibla utils
const KAABA_LAT = 21.422487;
const KAABA_LON = 39.826206;
function toRad(d) { return d * Math.PI / 180; }
function toDeg(r) { return r * 180 / Math.PI; }
function computeInitialBearing(lat1, lon1, lat2, lon2) {
    const Ï†1 = toRad(lat1);
    const Ï†2 = toRad(lat2);
    const Î”Î» = toRad(lon2 - lon1);
    const y = Math.sin(Î”Î») * Math.cos(Ï†2);
    const x = Math.cos(Ï†1) * Math.sin(Ï†2) - Math.sin(Ï†1) * Math.cos(Ï†2) * Math.cos(Î”Î»);
    let Î¸ = Math.atan2(y, x);
    let brng = (toDeg(Î¸) + 360) % 360;
    return brng;
}

function updateQibla(lat, lon) {
    if (typeof lat !== 'number' || typeof lon !== 'number') return;
    currentQiblaBearing = computeInitialBearing(lat, lon, KAABA_LAT, KAABA_LON);
    const degEl = document.getElementById('qiblaDegree');
    const arrow = document.getElementById('qiblaArrow');
    if (degEl) degEl.textContent = `Ø§Ù„Ø²Ø§ÙˆÙŠØ©: ${Math.round(currentQiblaBearing)}Â°`;
    if (arrow && !deviceOrientationHandler) {
        requestAnimationFrame(()=> arrow.style.transform = `rotate(${currentQiblaBearing}deg)`);
    }
}

function enableDeviceCompass() {
    if (deviceOrientationHandler) return;
    function getScreenOrientationAngle() {
        try { if (screen && screen.orientation && typeof screen.orientation.angle === 'number') return screen.orientation.angle; } catch (e) {}
        if (typeof window.orientation === 'number') return window.orientation;
        return 0;
    }
    function handle(e) {
        let heading = null;
        if (typeof e.webkitCompassHeading !== 'undefined' && e.webkitCompassHeading !== null) {
            heading = e.webkitCompassHeading;
        } else if (typeof e.alpha === 'number') {
            const alpha = e.alpha;
            const screenAngle = getScreenOrientationAngle();
            heading = (360 - alpha + screenAngle) % 360;
        }
        if (heading === null) return;
        const arrow = document.getElementById('qiblaArrow');
        if (!arrow || currentQiblaBearing === null) return;
        const rotation = (currentQiblaBearing - heading + 360) % 360;
        requestAnimationFrame(()=> arrow.style.transform = `rotate(${rotation}deg)`);
        const degEl = document.getElementById('qiblaDegree');
        if (degEl) degEl.textContent = `Ø§Ù„Ø²Ø§ÙˆÙŠØ©: ${Math.round(currentQiblaBearing)}Â° â€¢ Ø¨ÙˆØµÙ„ØªÙƒ: ${Math.round(heading)}Â°`;
    }
    const ensureQiblaThenEnable = () => {
        if (currentQiblaBearing !== null) {
            const attach = () => { window.addEventListener('deviceorientation', handle, true); deviceOrientationHandler = handle; showToast('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ÙˆØµÙ„Ø©'); };
            if (window.DeviceOrientationEvent && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(response => { if (response === 'granted') { attach(); } else { showToast('Ù„Ù… ÙŠØªÙ… Ù…Ù†Ø­ Ø¥Ø°Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù…Ø³ØªØ´Ø¹Ø± Ø§Ù„Ø¨ÙˆØµÙ„Ø©'); } }).catch(()=> showToast('Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø·Ù„Ø¨ Ø¥Ø°Ù† Ø§Ù„Ø¨ÙˆØµÙ„Ø©'));
            } else { attach(); }
            return;
        }
        try {
            const saved = JSON.parse(localStorage.getItem('prayer_location') || 'null');
            if (saved && saved.city) {
                geocodeCity(saved.city, saved.country).then(coords => {
                    if (coords) {
                        updateQibla(coords.lat, coords.lon);
                        ensureQiblaThenEnable();
                    } else if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(p=>{ updateQibla(p.coords.latitude, p.coords.longitude); ensureQiblaThenEnable(); }, ()=>{ showToast('ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø£Ùˆ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.'); });
                    } else { showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆÙ‚Ø¹ Ù…Ø­Ø¯Ø¯ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø¨Ù„Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± "Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ÙŠ".'); }
                });
                return;
            }
        } catch(e) {}
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p=>{ updateQibla(p.coords.latitude, p.coords.longitude); ensureQiblaThenEnable(); }, ()=>{ showToast('ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø£Ùˆ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹.'); }, { timeout: 8000 });
        } else {
            showToast('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØ³ÙŠÙ„Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø¨Ù„Ø©. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹.');
        }
    };
    ensureQiblaThenEnable();
}

function disableDeviceCompass() {
    if (!deviceOrientationHandler) return;
    window.removeEventListener('deviceorientation', deviceOrientationHandler, true);
    deviceOrientationHandler = null;
    const arrow = document.getElementById('qiblaArrow');
    if (arrow && currentQiblaBearing !== null) arrow.style.transform = `rotate(${currentQiblaBearing}deg)`;
}

// Geocoding
function geocodeCity(city, country) {
    if (!city) return Promise.resolve(null);
    const q = country ? `${city}, ${country}` : city;
    const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(q)}&limit=1`;
    return fetch(url, { method: 'GET' })
        .then(r => r.ok ? r.json() : Promise.reject(new Error('Geocode failed')))
        .then(arr => {
            if (!Array.isArray(arr) || arr.length === 0) return null;
            const first = arr[0];
            const lat = parseFloat(first.lat);
            const lon = parseFloat(first.lon);
            if (isNaN(lat) || isNaN(lon)) return null;
            return { lat, lon };
        }).catch(err => { console.warn('geocode error', err); return null; });
}

function promptForLocation() {
    const modal = document.getElementById('locationModal');
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        const saved = localStorage.getItem('prayer_location');
        if (saved) {
            try { const obj = JSON.parse(saved); const cityEl = document.getElementById('locCity'); const countryEl = document.getElementById('locCountry'); if (cityEl) cityEl.value = obj.city || ''; if (countryEl) countryEl.value = obj.country || ''; } catch(e) {}
        }
        const cityInput = document.getElementById('locCity'); if (cityInput) setTimeout(()=> cityInput.focus(), 80);
        return;
    }
    const city = prompt('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø£Ùˆ Ø§Ø¶ØºØ· Ø¥Ù„ØºØ§Ø¡ Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ: (Ù…Ø«Ø§Ù„: Cairo)');
    if (!city) { if (navigator.geolocation) navigator.geolocation.getCurrentPosition(p => fetchPrayerTimes(p.coords.latitude, p.coords.longitude), () => showToast('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© ÙŠØ¯ÙˆÙŠØ§Ù‹.')); return; }
    fetchPrayerTimesByCity(city, '');
}

function closeLocationModal(){ const modal = document.getElementById('locationModal'); if (modal) { modal.classList.remove('active'); document.body.style.overflow = ''; } }

function updatePrayerLocationDisplay() {
    const locDisplay = document.getElementById('prayerLocationName');
    const inlineDisplay = document.getElementById('inlinePrayerLocationName');
    let text = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    try{ const saved = JSON.parse(localStorage.getItem('prayer_location') || 'null'); if (saved && saved.city) text = saved.country ? `${saved.city}, ${saved.country}` : saved.city; }catch(e){ text = 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'; }
    if (locDisplay) locDisplay.textContent = text; if (inlineDisplay) inlineDisplay.textContent = text;
}

function showInlineLocationForm() { const form = document.getElementById('inlineLocationForm'); if (!form) return; form.style.display = 'flex'; form.style.flexWrap = 'wrap'; const city = document.getElementById('inlineLocCity'); if (city) setTimeout(()=> city.focus(), 60); }
function hideInlineLocationForm() { const form = document.getElementById('inlineLocationForm'); if (!form) return; form.style.display = 'none'; }

function fetchPrayerTimesByCity(city, country){ const q = `https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(city)}&country=${encodeURIComponent(country||'')}&method=${PRAYER_API_METHOD}`; fetch(q).then(r=>r.json()).then(data=>{ if (data && data.data) renderPrayerTimes(data.data); else showToast('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©'); }).catch(()=> showToast('Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©')); }

function fetchPrayerTimes(lat, lng) { fetch(`https://api.aladhan.com/v1/timings?latitude=${lat}&longitude=${lng}&method=${PRAYER_API_METHOD}`).then(r=>r.json()).then(data=>{ if (data && data.data) renderPrayerTimes(data.data); else showToast('ØªØ¹Ø°Ø± Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©'); }).catch(()=> showToast('Ø®Ø·Ø£ Ø¹Ù†Ø¯ Ø¬Ù„Ø¨ Ù…ÙˆØ§Ù‚ÙŠØª Ø§Ù„ØµÙ„Ø§Ø©')); }

function renderPrayerTimes(payload) { const list = document.getElementById('prayerList'); if (!list) return; const timings = payload.timings; list.innerHTML = ''; const order = ['Fajr','Sunrise','Dhuhr','Asr','Maghrib','Isha']; order.forEach(key => { if (!timings[key]) return; const row = document.createElement('div'); row.className = 'prayer-row'; row.innerHTML = `<span class="prayer-name">${arabicPrayerName(key)}</span><span class="prayer-time">${timings[key]}</span>`; list.appendChild(row); }); clearScheduledPrayers(); schedulePrayerNotifications(timings); }

function arabicPrayerName(key) { switch(key) { case 'Fajr': return 'Ø§Ù„ÙØ¬Ø±'; case 'Sunrise': return 'Ø§Ù„Ø´Ø±ÙˆÙ‚'; case 'Dhuhr': return 'Ø§Ù„Ø¸Ù‡Ø±'; case 'Asr': return 'Ø§Ù„Ø¹ØµØ±'; case 'Maghrib': return 'Ø§Ù„Ù…ØºØ±Ø¨'; case 'Isha': return 'Ø§Ù„Ø¹Ø´Ø§Ø¡'; default: return key; } }

function clearScheduledPrayers() { scheduledPrayerTimeouts.forEach(t => clearTimeout(t)); scheduledPrayerTimeouts = []; }

function schedulePrayerNotifications(timings) { const now = new Date(); Object.keys(timings).forEach(key => { const timeStr = timings[key]; const hhmm = timeStr.split(' ')[0]; const [hh, mm] = hhmm.split(':').map(Number); if (isNaN(hh) || isNaN(mm)) return; const target = new Date(now.getFullYear(), now.getMonth(), now.getDate(), hh, mm, 0, 0); if (target <= now) return; const delay = target - now; const t = setTimeout(()=>{ const name = arabicPrayerName(key); showToast(`Ø­Ø§Ù† Ø§Ù„Ø¢Ù† ÙˆÙ‚Øª ${name}`); showNotification('Ù…ÙˆØ¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø©', `Ø­Ø§Ù† Ø§Ù„Ø¢Ù† ÙˆÙ‚Øª ${name}`); }, delay); scheduledPrayerTimeouts.push(t); }); }

// Azkar data & modal
const azkarData = { morning: { title: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„ØµØ¨Ø§Ø­', items: [ { text: 'Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ ÙˆÙØ£ÙØµÙ’Ø¨ÙØ­Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡ÙØŒ Ù„Ø§Ù Ø¥ÙÙ„ÙÙ€Ù‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ø§Ù„Ù„Ù‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„Ø§Ù Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡Ù', count: 1 }, { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙÙƒÙ Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙØ­Ù’ÙŠÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙÙ…ÙÙˆØªÙ ÙˆÙØ¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù†ÙÙ‘Ø´ÙÙˆØ±Ù', count: 1 }, { text: 'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡Ù', count: 100 }, { text: 'Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„ÙØ§ Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡ÙØŒ Ù„ÙÙ‡Ù Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ ÙˆÙÙ„ÙÙ‡Ù Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù ÙˆÙÙ‡ÙÙˆÙ Ø¹ÙÙ„ÙÙ‰ ÙƒÙÙ„ÙÙ‘ Ø´ÙÙŠÙ’Ø¡Ù Ù‚ÙØ¯ÙÙŠØ±ÙŒ', count: 100 }, { text: 'Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ£ÙØªÙÙˆØ¨Ù Ø¥ÙÙ„ÙÙŠÙ’Ù‡Ù', count: 100 } ] }, evening: { title: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù…Ø³Ø§Ø¡', items: [ { text: 'Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ ÙˆÙØ£ÙÙ…Ù’Ø³ÙÙ‰ Ø§Ù„Ù’Ù…ÙÙ„Ù’ÙƒÙ Ù„Ù„Ù‡ÙØŒ ÙˆÙØ§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„Ù„Ù‡ÙØŒ Ù„ÙØ§ Ø¥ÙÙ„ÙÙ‡Ù Ø¥ÙÙ„Ø§ÙÙ‘ Ø§Ù„Ù„Ù‡Ù ÙˆÙØ­Ù’Ø¯ÙÙ‡Ù Ù„Ø§Ù Ø´ÙØ±ÙÙŠÙƒÙ Ù„ÙÙ‡Ù', count: 1 }, { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¨ÙÙƒÙ Ø£ÙÙ…Ù’Ø³ÙÙŠÙ’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ø£ÙØµÙ’Ø¨ÙØ­Ù’Ù†ÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙØ­Ù’ÙŠÙØ§ØŒ ÙˆÙØ¨ÙÙƒÙ Ù†ÙÙ…ÙÙˆØªÙ ÙˆÙØ¥ÙÙ„ÙÙŠÙ’ÙƒÙ Ø§Ù„Ù’Ù…ÙØµÙÙŠØ±Ù', count: 1 }, { text: 'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙØ¨ÙØ­ÙÙ…Ù’Ø¯ÙÙ‡Ù', count: 100 }, { text: 'Ø£ÙØ¹ÙÙˆØ°Ù Ø¨ÙÙƒÙÙ„ÙÙ…ÙØ§ØªÙ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø§Ù„ØªÙÙ‘Ø§Ù…ÙÙ‘Ø§ØªÙ Ù…ÙÙ†Ù’ Ø´ÙØ±ÙÙ‘ Ù…ÙØ§ Ø®ÙÙ„ÙÙ‚Ù', count: 3 } ] }, sleep: { title: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ù†ÙˆÙ…', items: [ { text: 'Ø¨ÙØ§Ø³Ù’Ù…ÙÙƒÙ Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ…ÙÙˆØªÙ ÙˆÙØ£ÙØ­Ù’ÙŠÙØ§', count: 1 }, { text: 'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù', count: 33 }, { text: 'Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù', count: 33 }, { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù', count: 34 } ] }, prayer: { title: 'Ø£Ø°ÙƒØ§Ø± Ø¨Ø¹Ø¯ Ø§Ù„ØµÙ„Ø§Ø©', items: [ { text: 'Ø£ÙØ³Ù’ØªÙØºÙ’ÙÙØ±Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù', count: 3 }, { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø£ÙÙ†Ù’ØªÙ Ø§Ù„Ø³ÙÙ‘Ù„Ø§ÙÙ…ÙØŒ ÙˆÙÙ…ÙÙ†Ù’ÙƒÙ Ø§Ù„Ø³ÙÙ‘Ù„Ø§ÙÙ…ÙØŒ ØªÙØ¨ÙØ§Ø±ÙÙƒÙ’ØªÙ ÙŠÙØ§ Ø°ÙØ§ Ø§Ù„Ù’Ø¬ÙÙ„Ø§ÙÙ„Ù ÙˆÙØ§Ù„Ø¥ÙÙƒÙ’Ø±ÙØ§Ù…Ù', count: 1 }, { text: 'Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„Ù„ÙÙ‘Ù‡Ù', count: 33 }, { text: 'Ø§Ù„Ù’Ø­ÙÙ…Ù’Ø¯Ù Ù„ÙÙ„ÙÙ‘Ù‡Ù', count: 33 }, { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±Ù', count: 33 } ] }, travel: { title: 'Ø£Ø°ÙƒØ§Ø± Ø§Ù„Ø³ÙØ±', items: [ { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±ÙØŒ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±ÙØŒ Ø§Ù„Ù„ÙÙ‘Ù‡Ù Ø£ÙÙƒÙ’Ø¨ÙØ±ÙØŒ Ø³ÙØ¨Ù’Ø­ÙØ§Ù†Ù Ø§Ù„ÙÙ‘Ø°ÙÙŠ Ø³ÙØ®ÙÙ‘Ø±Ù Ù„ÙÙ†ÙØ§ Ù‡ÙØ°ÙØ§ ÙˆÙÙ…ÙØ§ ÙƒÙÙ†ÙÙ‘Ø§ Ù„ÙÙ‡Ù Ù…ÙÙ‚Ù’Ø±ÙÙ†ÙÙŠÙ†Ù', count: 1 }, { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ø¥ÙÙ†ÙÙ‘Ø§ Ù†ÙØ³Ù’Ø£ÙÙ„ÙÙƒÙ ÙÙÙŠ Ø³ÙÙÙØ±ÙÙ†ÙØ§ Ù‡ÙØ°ÙØ§ Ø§Ù„Ù’Ø¨ÙØ±ÙÙ‘ ÙˆÙØ§Ù„ØªÙÙ‘Ù‚Ù’ÙˆÙÙ‰', count: 1 }, { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ Ù‡ÙÙˆÙÙ‘Ù†Ù’ Ø¹ÙÙ„ÙÙŠÙ’Ù†ÙØ§ Ø³ÙÙÙØ±ÙÙ†ÙØ§ Ù‡ÙØ°ÙØ§ ÙˆÙØ§Ø·Ù’ÙˆÙ Ø¹ÙÙ†ÙÙ‘Ø§ Ø¨ÙØ¹Ù’Ø¯ÙÙ‡Ù', count: 1 } ] }, general: { title: 'Ø£Ø°ÙƒØ§Ø± Ù…ØªÙ†ÙˆØ¹Ø©', items: [ { text: 'Ù„ÙØ§ Ø­ÙÙˆÙ’Ù„Ù ÙˆÙÙ„ÙØ§ Ù‚ÙÙˆÙÙ‘Ø©Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ø¨ÙØ§Ù„Ù„ÙÙ‘Ù‡Ù', count: 10 }, { text: 'Ø­ÙØ³Ù’Ø¨ÙÙ†ÙØ§ Ø§Ù„Ù„ÙÙ‘Ù‡Ù ÙˆÙÙ†ÙØ¹Ù’Ù…Ù Ø§Ù„Ù’ÙˆÙÙƒÙÙŠÙ„Ù', count: 7 }, { text: 'Ø§Ù„Ù„ÙÙ‘Ù‡ÙÙ…ÙÙ‘ ØµÙÙ„ÙÙ‘ ÙˆÙØ³ÙÙ„ÙÙ‘Ù…Ù’ Ø¹ÙÙ„ÙÙ‰ Ù†ÙØ¨ÙÙŠÙÙ‘Ù†ÙØ§ Ù…ÙØ­ÙÙ…ÙÙ‘Ø¯Ù', count: 10 } ] } };

let zikrCounts = {};

function openAzkarModal(category) {
    const data = azkarData[category];
    if (!data) return;
    if (!zikrCounts[category]) { zikrCounts[category] = data.items.map(() => 0); }
    document.getElementById('modalTitle').textContent = data.title;
    const modalBody = document.getElementById('modalBody');
    modalBody.innerHTML = data.items.map((item, index) => `\n        <div class="zikr-item">\n            <p class="zikr-text">${item.text}</p>\n            <div class="zikr-count-container">\n                <div class="zikr-counter">\n                    <button onclick="decrementZikr('${category}', ${index})">-</button>\n                    <span id="zikr-${category}-${index}">${zikrCounts[category][index]} / ${item.count}</span>\n                    <button onclick="incrementZikr('${category}', ${index}, ${item.count})">+</button>\n                </div>\n                <span class="zikr-target">Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ${item.count} Ù…Ø±Ø©</span>\n            </div>\n        </div>\n    `).join('');
    document.getElementById('azkarModal').classList.add('active');
    document.body.style.overflow = 'hidden';
}

function closeAzkarModal() { document.getElementById('azkarModal').classList.remove('active'); document.body.style.overflow = ''; }

function incrementZikr(category, index, max) { if (zikrCounts[category][index] < max) { zikrCounts[category][index]++; document.getElementById(`zikr-${category}-${index}`).textContent = `${zikrCounts[category][index]} / ${max}`; if (soundEnabled) playClickSound(); } }

function decrementZikr(category, index) { const data = azkarData[category]; if (zikrCounts[category][index] > 0) { zikrCounts[category][index]--; document.getElementById(`zikr-${category}-${index}`).textContent = `${zikrCounts[category][index]} / ${data.items[index].count}`; } }

document.getElementById('azkarModal')?.addEventListener('click', (e) => { if (e.target.id === 'azkarModal') { closeAzkarModal(); } });
document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { closeAzkarModal(); } });

// ========================================
// Initialize
// ========================================
document.addEventListener('DOMContentLoaded', () => {
    initHadithCarousel();
    initPrayerWidget();
    document.querySelectorAll('a[href^="#"]').forEach(anchor => { anchor.addEventListener('click', function (e) { e.preventDefault(); const target = document.querySelector(this.getAttribute('href')); if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' }); }); });

    const saveBtn = document.getElementById('saveLocationBtn');
    const cancelBtn = document.getElementById('cancelLocationBtn');
    const closeBtn = document.getElementById('closeLocationModal');
    const locModal = document.getElementById('locationModal');

    if (saveBtn) saveBtn.addEventListener('click', ()=>{
        const cityEl = document.getElementById('locCity');
        const countryEl = document.getElementById('locCountry');
        const city = cityEl ? cityEl.value.trim() : '';
        const country = countryEl ? countryEl.value.trim() : '';
        if (!city) { showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©'); return; }
        localStorage.setItem('prayer_location', JSON.stringify({ city, country }));
        updatePrayerLocationDisplay();
        closeLocationModal();
        fetchPrayerTimesByCity(city, country);
        geocodeCity(city, country).then(coords => {
            if (coords) updateQibla(coords.lat, coords.lon);
            else if (navigator.geolocation) navigator.geolocation.getCurrentPosition(p=>{ try { updateQibla(p.coords.latitude, p.coords.longitude); } catch(e){} }, ()=>{}, { timeout: 6000 });
            else showToast('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø¨Ù„Ø©');
        });
    });
    if (cancelBtn) cancelBtn.addEventListener('click', closeLocationModal);
    if (closeBtn) closeBtn.addEventListener('click', closeLocationModal);
    if (locModal) locModal.addEventListener('click', (e)=>{ if (e.target.id === 'locationModal') closeLocationModal(); });

    const toggleInlineBtn = document.getElementById('toggleInlineLocationBtn');
    const inlineSaveBtn = document.getElementById('inlineSaveLocationBtn');
    const inlineCancelBtn = document.getElementById('inlineCancelLocationBtn');
    if (toggleInlineBtn) toggleInlineBtn.addEventListener('click', ()=>{ showInlineLocationForm(); });
    if (inlineSaveBtn) inlineSaveBtn.addEventListener('click', ()=>{ const cityEl = document.getElementById('inlineLocCity'); const countryEl = document.getElementById('inlineLocCountry'); const city = cityEl ? cityEl.value.trim() : ''; const country = countryEl ? countryEl.value.trim() : ''; if (!city) { showToast('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©'); return; } localStorage.setItem('prayer_location', JSON.stringify({ city, country })); updatePrayerLocationDisplay(); hideInlineLocationForm(); fetchPrayerTimesByCity(city, country); geocodeCity(city, country).then(coords => { if (coords) updateQibla(coords.lat, coords.lon); else if (navigator.geolocation) navigator.geolocation.getCurrentPosition(p=>{ try { updateQibla(p.coords.latitude, p.coords.longitude); } catch(e){} }, ()=>{}, { timeout: 6000 }); else showToast('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù‚Ø¨Ù„Ø©'); }); });
    if (inlineCancelBtn) inlineCancelBtn.addEventListener('click', ()=>{ hideInlineLocationForm(); });

    const locationPermissionModal = document.getElementById('locationPermissionModal');
    const retryGeoBtn = document.getElementById('retryGeolocationBtn');
    const dismissPermBtn = document.getElementById('dismissPermissionModal');
    const closePermModalBtn = document.getElementById('closePermissionModal');
    function showLocationPermissionModal(){ if (locationPermissionModal) { locationPermissionModal.classList.add('active'); document.body.style.overflow='hidden'; } }
    function hideLocationPermissionModal(){ if (locationPermissionModal) { locationPermissionModal.classList.remove('active'); document.body.style.overflow=''; } }
    if (retryGeoBtn) retryGeoBtn.addEventListener('click', ()=>{ hideLocationPermissionModal(); qiblaGeoBtn && qiblaGeoBtn.click(); });
    if (dismissPermBtn) dismissPermBtn.addEventListener('click', hideLocationPermissionModal);
    if (closePermModalBtn) closePermModalBtn.addEventListener('click', hideLocationPermissionModal);

    const qiblaGeoBtn = document.getElementById('qiblaUseGeoBtn');
    const qiblaDeviceBtn = document.getElementById('qiblaUseDeviceBtn');
    if (qiblaGeoBtn) qiblaGeoBtn.addEventListener('click', ()=>{
        if (!navigator.geolocation) { showToast('Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­'); return; }
        const tryGeolocate = () => {
            showToast('Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...');
            navigator.geolocation.getCurrentPosition(pos => { updateQibla(pos.coords.latitude, pos.coords.longitude); fetchPrayerTimes(pos.coords.latitude, pos.coords.longitude); }, err => { if (err && err.code === 1) { showLocationPermissionModal(); } else if (err && err.code === 2) { showToast('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø­Ø§Ù„ÙŠØ§Ù‹. Ø­Ø§ÙˆÙ„ ÙÙŠ Ù…ÙƒØ§Ù† Ø¨Ù‡ Ø¥Ø´Ø§Ø±Ø© GPS Ø£ÙØ¶Ù„.'); } else if (err && err.code === 3) { showToast('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.'); } else { showToast('ØªØ¹Ø°Ø± Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ÙˆÙ‚Ø¹Ùƒ. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹.'); } }, { timeout: 10000, enableHighAccuracy: true });
        };
        if (navigator.permissions && navigator.permissions.query) {
            try { navigator.permissions.query({ name: 'geolocation' }).then(p => { if (p.state === 'granted') { tryGeolocate(); } else if (p.state === 'prompt') { tryGeolocate(); } else if (p.state === 'denied') { showLocationPermissionModal(); p.onchange = () => { if (p.state === 'granted') tryGeolocate(); }; } else { tryGeolocate(); } }).catch(()=> tryGeolocate()); } catch(e) { tryGeolocate(); }
        } else { tryGeolocate(); }
    });
    if (qiblaDeviceBtn) qiblaDeviceBtn.addEventListener('click', ()=>{ if (deviceOrientationHandler) { disableDeviceCompass(); showToast('ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¨ÙˆØµÙ„Ø©'); } else enableDeviceCompass(); });
});

const style = document.createElement('style');
style.textContent = `@keyframes pulse { 0%,100% { transform: scale(1);} 50% { transform: scale(1.1);} }`;
document.head.appendChild(style);

    </script>
    <!-- Toast container -->
    <div id="toastContainer" aria-live="polite" aria-atomic="true" style="position:fixed;bottom:20px;left:20px;z-index:9999"></div>
</body>
</html>

